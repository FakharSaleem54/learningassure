<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Course Builder - Learning Assure</title>
  <link rel="stylesheet" href="style.css">
  <script src="js/data.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/courses.js"></script>
  <script src="js/main.js" defer></script>
</head>
<body id="page-course-builder">
  <!-- Header -->
  <header class="main-header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <img src="assets/images/logo.png" alt="Learning Assure">
        </div>
        <nav class="navbar">
          <ul>
            <li><a href="instructor-dashboard.html">Dashboard</a></li>
            <li><a href="catalog.html">Browse Courses</a></li>
            <li><a href="forum.html">Forum</a></li>
          </ul>
        </nav>
        <div class="user-menu">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="page-header">
      <h1 id="courseBuilderTitle">Create New Course</h1>
      <p>Build and organize your course content</p>
    </div>

    <div class="course-builder-layout">
      <!-- Sidebar - Course Outline -->
      <div class="course-sidebar">
        <div class="sidebar-header">
          <h3>Course Outline</h3>
          <button class="btn small primary" onclick="CourseBuilder.addModule()">
            <span class="btn-icon">‚ûï</span>
            Add Module
          </button>
        </div>
        <div id="courseOutline" class="course-outline">
          <!-- Course modules and lessons will be populated here -->
        </div>
      </div>

      <!-- Main Content Area -->
      <div class="course-content">
        <!-- Course Settings Tab -->
        <div id="courseSettingsTab" class="content-tab active">
          <div class="content-header">
            <h3>Course Settings</h3>
          </div>
          <form id="courseSettingsForm" class="course-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="courseTitle">Course Title *</label>
                <input type="text" id="courseTitle" name="title" class="input" placeholder="Enter course title" required>
              </div>
              <div class="form-group">
                <label for="courseCategory">Category</label>
                <select id="courseCategory" name="category" class="input">
                  <option value="">Select category</option>
                  <option value="Technology">Technology</option>
                  <option value="Business">Business</option>
                  <option value="Design">Design</option>
                  <option value="Marketing">Marketing</option>
                  <option value="Data Science">Data Science</option>
                  <option value="Languages">Languages</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="courseLevel">Level</label>
                <select id="courseLevel" name="level" class="input">
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate">Intermediate</option>
                  <option value="Advanced">Advanced</option>
                </select>
              </div>
              <div class="form-group">
                <label for="coursePrice">Price ($)</label>
                <input type="number" id="coursePrice" name="price" class="input" min="0" step="0.01" placeholder="0.00">
              </div>
            </div>

            <div class="form-group">
              <label for="courseDescription">Description *</label>
              <textarea id="courseDescription" name="description" class="input" rows="4" placeholder="Describe your course..." required></textarea>
            </div>

            <div class="form-group">
              <label for="courseThumbnail">Thumbnail URL</label>
              <input type="url" id="courseThumbnail" name="thumbnail" class="input" placeholder="https://example.com/image.jpg">
            </div>

            <div class="form-group">
              <label for="courseTags">Tags (comma-separated)</label>
              <input type="text" id="courseTags" name="tags" class="input" placeholder="javascript, web development, programming">
            </div>

            <div class="form-actions">
              <button type="button" class="btn outline" onclick="CourseBuilder.saveDraft()">Save Draft</button>
              <button type="button" class="btn primary" onclick="CourseBuilder.publishCourse()">Publish Course</button>
            </div>
          </form>
        </div>

        <!-- Content Editor Tab -->
        <div id="contentEditorTab" class="content-tab">
          <div class="content-header">
            <div class="content-header-left">
              <h3 id="editorTitle">Content Editor</h3>
              <span id="currentItemType" class="item-type-badge">Select an item to edit</span>
            </div>
            <div class="content-header-actions">
              <button class="btn small outline" onclick="CourseBuilder.previewContent()">Preview</button>
              <button class="btn small primary" onclick="CourseBuilder.saveContent()">Save</button>
            </div>
          </div>

          <div id="contentEditor" class="content-editor">
            <!-- Content editor will be populated based on selected item -->
            <div class="editor-placeholder">
              <div class="placeholder-icon">üìù</div>
              <h4>Select a lesson or quiz to edit</h4>
              <p>Choose an item from the course outline to start editing content.</p>
            </div>
                  <select id="courseVisibility" name="visibility" class="input">
                    <option value="draft">Draft (Private)</option>
                    <option value="published">Published (Public)</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="enrollmentType">Enrollment</label>
                  <select id="enrollmentType" name="enrollmentType" class="input">
                    <option value="open">Open Enrollment</option>
                    <option value="approval">Requires Approval</option>
                  </select>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Module/Lesson Editor Tab -->
        <div id="contentEditorTab" class="content-tab">
          <div class="editor-header">
            <h2 id="editorTitle">Select a lesson to edit</h2>
            <div class="editor-actions">
              <button class="btn small outline" onclick="CourseBuilder.saveContent()">
                <span class="btn-icon">üíæ</span>
                Save
              </button>
            </div>
          </div>

          <div id="lessonEditor" class="lesson-editor">
            <!-- Lesson content editor will be populated here -->
            <div class="editor-placeholder">
              <p>Select a lesson from the outline to start editing.</p>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Add Module Modal -->
  <div id="addModuleModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Module</h3>
        <button class="modal-close" onclick="CourseBuilder.closeAddModuleModal()">&times;</button>
      </div>
      <form id="addModuleForm" onsubmit="event.preventDefault(); CourseBuilder.submitAddModule(this)">
        <div class="form-group">
          <label for="moduleTitle">Module Title *</label>
          <input type="text" id="moduleTitle" name="title" class="input" required>
        </div>
        <div class="form-group">
          <label for="moduleDescription">Description</label>
          <textarea id="moduleDescription" name="description" class="input" rows="3" placeholder="Optional module description..."></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn outline" onclick="CourseBuilder.closeAddModuleModal()">Cancel</button>
          <button type="submit" class="btn primary">Add Module</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Lesson Modal -->
  <div id="addLessonModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Lesson</h3>
        <button class="modal-close" onclick="CourseBuilder.closeAddLessonModal()">&times;</button>
      </div>
      <form id="addLessonForm" onsubmit="event.preventDefault(); CourseBuilder.submitAddLesson(this)">
        <input type="hidden" id="lessonModuleId" name="moduleId">
        <div class="form-group">
          <label for="lessonTitle">Lesson Title *</label>
          <input type="text" id="lessonTitle" name="title" class="input" required>
        </div>
        <div class="form-group">
          <label for="lessonType">Lesson Type</label>
          <select id="lessonType" name="type" class="input">
            <option value="video">Video</option>
            <option value="text">Text</option>
            <option value="live_class">Live Class (Zoom/Teams)</option>
            <option value="quiz">Quiz</option>
            <option value="assignment">Assignment</option>
          </select>
        </div>
        <div class="form-group" id="videoUrlGroup">
          <label for="lessonVideoUrl">Video URL</label>
          <input type="url" id="lessonVideoUrl" name="videoUrl" class="input" placeholder="https://youtube.com/... or upload URL">
        </div>
        <div class="form-group" id="liveClassUrlGroup" style="display: none;">
          <label for="lessonLiveClassUrl">Live Class URL (Optional)</label>
          <input type="url" id="lessonLiveClassUrl" name="liveClassUrl" class="input" placeholder="https://zoom.us/... or https://meet.google.com/...">
        </div>
        <div class="form-group" id="quizSelectGroup" style="display: none;">
          <label for="lessonQuizId">Select Quiz</label>
          <select id="lessonQuizId" name="quizId" class="input">
            <!-- Quizzes will be populated here -->
          </select>
        </div>
        <div class="form-actions">
          <button type="button" class="btn outline" onclick="CourseBuilder.closeAddLessonModal()">Cancel</button>
          <button type="submit" class="btn primary">Add Lesson</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>Learning Assure</h4>
          <p>Empowering educators to share knowledge worldwide.</p>
          <div class="social-links">
            <a href="#" class="social-link">üìò Facebook</a>
            <a href="#" class="social-link">üê¶ Twitter</a>
            <a href="#" class="social-link">üì∑ Instagram</a>
            <a href="#" class="social-link">üíº LinkedIn</a>
          </div>
        </div>
        <div class="footer-section">
          <h4>Platform</h4>
          <ul>
            <li><a href="catalog.html">Browse Courses</a></li>
            <li><a href="bundles.html">Course Bundles</a></li>
            <li><a href="learning_paths.html">Learning Paths</a></li>
            <li><a href="instructor-dashboard.html">Become an Instructor</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Community</h4>
          <ul>
            <li><a href="forum.html">Discussion Forum</a></li>
            <li><a href="#">Student Community</a></li>
            <li><a href="#">Instructor Hub</a></li>
            <li><a href="#">Events & Webinars</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">System Status</a></li>
            <li><a href="#">Feedback</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Legal</h4>
          <ul>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Cookie Policy</a></li>
            <li><a href="#">Accessibility</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <div class="footer-bottom-content">
          <p>&copy; 2025 Learning Assure. All rights reserved.</p>
          <div class="footer-nav">
            <a href="#">About</a>
            <a href="#">Careers</a>
            <a href="#">Press</a>
            <a href="#">Investors</a>
            <a href="#">Blog</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Course Builder JavaScript will be added here
    const CourseBuilder = {
      currentCourse: null,
      currentLesson: null,

      init() {
        this.loadCourse();
        this.setupEventListeners();
      },

      loadCourse() {
        // Load course from URL parameter or create new
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('id');

        if (courseId) {
          // Load existing course
          this.currentCourse = Courses.getCourseById(courseId);
        } else {
          // Create new course
          this.currentCourse = {
            id: Date.now().toString(),
            title: '',
            description: '',
            category: '',
            level: 'Beginner',
            price: 0,
            thumbnail: '',
            visibility: 'draft',
            enrollmentType: 'open',
            modules: [],
            createdAt: new Date().toISOString(),
            instructorId: Auth.getCurrentUser()?.id
          };
        }

        this.populateCourseDetails();
        this.renderOutline();
      },

      populateCourseDetails() {
        document.getElementById('courseTitle').value = this.currentCourse.title || '';
        document.getElementById('courseCategory').value = this.currentCourse.category || '';
        document.getElementById('courseLevel').value = this.currentCourse.level || 'Beginner';
        document.getElementById('coursePrice').value = this.currentCourse.price || '';
        document.getElementById('courseDescription').value = this.currentCourse.description || '';
        document.getElementById('courseThumbnail').value = this.currentCourse.thumbnail || '';
        document.getElementById('courseVisibility').value = this.currentCourse.visibility || 'draft';
        document.getElementById('enrollmentType').value = this.currentCourse.enrollmentType || 'open';
      },

      renderOutline() {
        const outline = document.getElementById('courseOutline');
        if (!this.currentCourse.modules || this.currentCourse.modules.length === 0) {
          outline.innerHTML = '<div class="outline-placeholder"><p>No modules yet. Click "Add Module" to get started.</p></div>';
          return;
        }

        outline.innerHTML = this.currentCourse.modules.map(module => `
          <div class="outline-module" data-module-id="${module.id}">
            <div class="module-header">
              <h4>${module.title}</h4>
              <div class="module-actions">
                <button onclick="CourseBuilder.addLesson('${module.id}')" class="btn-icon small">‚ûï</button>
                <button onclick="CourseBuilder.editModule('${module.id}')" class="btn-icon small">‚úèÔ∏è</button>
                <button onclick="CourseBuilder.deleteModule('${module.id}')" class="btn-icon small">üóëÔ∏è</button>
              </div>
            </div>
            <div class="module-lessons sortable-lessons" data-module-id="${module.id}">
              ${module.lessons ? module.lessons.map(lesson => `
                <div class="outline-lesson sortable-item" data-lesson-id="${lesson.id}" onclick="CourseBuilder.editLesson('${module.id}', '${lesson.id}')">
                  <span class="lesson-icon">${this.getLessonIcon(lesson.type)}</span>
                  <span class="lesson-title">${lesson.title}</span>
                  <span class="lesson-type">${lesson.type}</span>
                  <span class="drag-handle">‚ãÆ‚ãÆ</span>
                </div>
              `).join('') : '<div class="no-lessons">No lessons yet</div>'}
            </div>
          </div>
        `).join('');

        // Initialize Sortable for modules
        const outlineContainer = document.getElementById('courseOutline');
        if (outlineContainer && !outlineContainer.sortable) {
          outlineContainer.sortable = Sortable.create(outlineContainer, {
            handle: '.module-header',
            animation: 150,
            onEnd: (evt) => {
              const oldIndex = evt.oldIndex;
              const newIndex = evt.newIndex;
              if (oldIndex !== newIndex) {
                const module = this.currentCourse.modules.splice(oldIndex, 1)[0];
                this.currentCourse.modules.splice(newIndex, 0, module);
                this.saveDraft();
              }
            }
          });
        }

        // Initialize Sortable for lessons within each module
        document.querySelectorAll('.sortable-lessons').forEach(container => {
          if (!container.sortable) {
            container.sortable = Sortable.create(container, {
              handle: '.drag-handle',
              animation: 150,
              onEnd: (evt) => {
                const moduleId = container.dataset.moduleId;
                const module = this.currentCourse.modules.find(m => m.id === moduleId);
                if (module && module.lessons) {
                  const oldIndex = evt.oldIndex;
                  const newIndex = evt.newIndex;
                  if (oldIndex !== newIndex) {
                    const lesson = module.lessons.splice(oldIndex, 1)[0];
                    module.lessons.splice(newIndex, 0, lesson);
                    this.saveDraft();
                  }
                }
              }
            });
          }
        });
      },

      getLessonIcon(type) {
        const icons = {
          video: 'üé•',
          text: 'üìÑ',
          live_class: 'üìπ',
          quiz: '‚ùì',
          assignment: 'üìù'
        };
        return icons[type] || 'üìÑ';
      },

      addModule() {
        document.getElementById('addModuleModal').style.display = 'flex';
      },

      closeAddModuleModal() {
        document.getElementById('addModuleModal').style.display = 'none';
        document.getElementById('addModuleForm').reset();
      },

      submitAddModule(form) {
        const formData = new FormData(form);
        const module = {
          id: Date.now().toString(),
          title: formData.get('title'),
          description: formData.get('description'),
          lessons: []
        };

        if (!this.currentCourse.modules) this.currentCourse.modules = [];
        this.currentCourse.modules.push(module);

        this.renderOutline();
        this.closeAddModuleModal();
      },

      addLesson(moduleId) {
        document.getElementById('lessonModuleId').value = moduleId;
        document.getElementById('addLessonModal').style.display = 'flex';
        this.updateLessonTypeFields();
      },

      closeAddLessonModal() {
        document.getElementById('addLessonModal').style.display = 'none';
        document.getElementById('addLessonForm').reset();
      },

      updateLessonTypeFields() {
        const type = document.getElementById('lessonType').value;
        document.getElementById('videoUrlGroup').style.display = type === 'video' ? 'block' : 'none';
        document.getElementById('liveClassUrlGroup').style.display = (type === 'video' || type === 'live_class') ? 'block' : 'none';
        document.getElementById('quizSelectGroup').style.display = type === 'quiz' ? 'block' : 'none';
      },

      submitAddLesson(form) {
        const formData = new FormData(form);
        const moduleId = formData.get('moduleId');
        const type = formData.get('type');

        const lesson = {
          id: Date.now().toString(),
          title: formData.get('title'),
          type: type,
          content: '',
          videoUrl: formData.get('videoUrl') || '',
          liveClassUrl: formData.get('liveClassUrl') || '',
          quizId: formData.get('quizId') || ''
        };

        const module = this.currentCourse.modules.find(m => m.id === moduleId);
        if (module) {
          if (!module.lessons) module.lessons = [];
          module.lessons.push(lesson);
        }

        this.renderOutline();
        this.closeAddLessonModal();
      },

      editLesson(moduleId, lessonId) {
        const module = this.currentCourse.modules.find(m => m.id === moduleId);
        const lesson = module?.lessons?.find(l => l.id === lessonId);

        if (lesson) {
          this.currentLesson = lesson;
          document.getElementById('editorTitle').textContent = `Editing: ${lesson.title}`;
          document.getElementById('courseDetailsTab').classList.remove('active');
          document.getElementById('contentEditorTab').classList.add('active');

          this.renderLessonEditor();
        }
      },

      renderLessonEditor() {
        const editor = document.getElementById('lessonEditor');
        if (!this.currentLesson) {
          editor.innerHTML = '<div class="editor-placeholder"><p>Select a lesson from the outline to start editing.</p></div>';
          return;
        }

        let contentHtml = '';

        switch (this.currentLesson.type) {
          case 'video':
            contentHtml = `
              <div class="form-group">
                <label for="lessonVideoUrl">Video URL</label>
                <input type="url" id="lessonVideoUrl" class="input" value="${this.currentLesson.videoUrl || ''}" placeholder="https://youtube.com/...">
              </div>
              <div class="form-group">
                <label for="lessonLiveClassUrl">Live Class URL (Optional)</label>
                <input type="url" id="lessonLiveClassUrl" class="input" value="${this.currentLesson.liveClassUrl || ''}" placeholder="https://zoom.us/... or https://meet.google.com/...">
              </div>
              <div class="form-group">
                <label for="lessonContent">Video Description</label>
                <textarea id="lessonContent" class="input" rows="6" placeholder="Add a description for this video lesson...">${this.currentLesson.content || ''}</textarea>
              </div>
            `;
            break;
          case 'text':
            contentHtml = `
              <div class="form-group">
                <label for="lessonContent">Lesson Content</label>
                <textarea id="lessonContent" class="input" rows="15" placeholder="Write your lesson content here...">${this.currentLesson.content || ''}</textarea>
              </div>
            `;
            break;
          case 'quiz':
            contentHtml = `
              <div class="form-group">
                <label for="lessonQuizId">Select Quiz</label>
                <select id="lessonQuizId" class="input">
                  <option value="">Choose a quiz...</option>
                  <!-- Quizzes would be loaded here -->
                </select>
              </div>
              <div class="form-group">
                <label for="lessonContent">Quiz Instructions</label>
                <textarea id="lessonContent" class="input" rows="6" placeholder="Add instructions for this quiz...">${this.currentLesson.content || ''}</textarea>
              </div>
            `;
            break;
          case 'assignment':
            contentHtml = `
              <div class="form-group">
                <label for="lessonContent">Assignment Instructions</label>
                <textarea id="lessonContent" class="input" rows="10" placeholder="Describe the assignment requirements...">${this.currentLesson.content || ''}</textarea>
              </div>
            `;
            break;
        }

        editor.innerHTML = contentHtml;
      },

      saveContent() {
        if (!this.currentLesson) return;

        const content = document.getElementById('lessonContent')?.value || '';
        const videoUrl = document.getElementById('lessonVideoUrl')?.value || '';
        const liveClassUrl = document.getElementById('lessonLiveClassUrl')?.value || '';
        const quizId = document.getElementById('lessonQuizId')?.value || '';

        this.currentLesson.content = content;
        if (videoUrl) this.currentLesson.videoUrl = videoUrl;
        if (liveClassUrl) this.currentLesson.liveClassUrl = liveClassUrl;
        if (quizId) this.currentLesson.quizId = quizId;

        alert('Lesson content saved!');
      },

      saveDraft() {
        // Update course details from form
        this.currentCourse.title = document.getElementById('courseTitle').value;
        this.currentCourse.category = document.getElementById('courseCategory').value;
        this.currentCourse.level = document.getElementById('courseLevel').value;
        this.currentCourse.price = parseFloat(document.getElementById('coursePrice').value) || 0;
        this.currentCourse.description = document.getElementById('courseDescription').value;
        this.currentCourse.thumbnail = document.getElementById('courseThumbnail').value;
        this.currentCourse.visibility = document.getElementById('courseVisibility').value;
        this.currentCourse.enrollmentType = document.getElementById('enrollmentType').value;

        // Save to courses
        Courses.saveCourse(this.currentCourse);
        alert('Course draft saved!');
      },

      publishCourse() {
        this.saveDraft();
        this.currentCourse.visibility = 'published';
        Courses.saveCourse(this.currentCourse);
        alert('Course published successfully!');
      },

      previewCourse() {
        // Open course in player mode
        window.open(`player.html?course=${this.currentCourse.id}`, '_blank');
      },

      setupEventListeners() {
        document.getElementById('lessonType').addEventListener('change', () => this.updateLessonTypeFields());
      }
    };

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      CourseBuilder.init();
    });
  </script>
</body>
</html>
